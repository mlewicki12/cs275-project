<!DOCTYPE html>
<html>
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- BootStrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <title>Mellow-fy - Index</title>

    <meta charset="UTF-8">

    <link rel="stylesheet" href="style.css">
  </head>

  <body>
    <div class="jumbotron text-center textPrimary background1">
      <h1 class="header">MELOFY</h1>
      <p class="quote"></p>
    </div>

    <div class="">
      <div class="container">
        <div class="loggedin">
          <div class="row">
            <div class="col-sm-4">
              <h3>Generate Playlist</h3>
              <p>Use our Melofy process to create special playlists just for your lifestyle.</p>
              <a href="./generator.html">
                <button type="button" class="btn btn-secondary thePink">Get the Music</button>
              </a>
            </div>
            <div class="col-sm-4">
              <h3>Credits</h3>
              <p>Check out who made this shitty site</p>
            </div>
            <div class="col-sm-4">
              <h3>Your Song SQL</h3>
              <p>A tracking of every song you've ever heard starting now or something like
                that. Though we probably aren't doing this</p>
              </div>
            </div>
          </div>
          <div class="login">
            <a href="./login">
              <button type="button" class="btn btn-secondary thePink" onclick="toggle()">Login</button>
            </a>
          </div>
        </div>
      </div>
    <!--Required for bootstrap -->
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
    <script src="js.cookie.js"></script>
    <script>

      function getHashParams() {
        var hashParams = {};
        var e, r = /([^&;=]+)=?([^&;]*)/g,
            q = window.location.hash.substring(1);
        while ( e = r.exec(q)) {
           hashParams[e[1]] = decodeURIComponent(e[2]);
        }
        return hashParams;
       }
       var params = getHashParams();
       var access_token = params.access,
           refresh_token = params.refresh;
       Cookies.set('access', access_token)
       Cookies.set('refresh', refresh_token)
       console.log("access on index: " + Cookies.get('access'))
       console.log("refresh on index: " + Cookies.get('refresh'))

       function profileRequest() {
          $.ajax({
            type: "GET",
            url: './profile?access=' + Cookies.get('access'), //creating the url used for the request
            contentType: "application/json; charset=utf-8",
            data: "{}",
            dataType: "html",
            success: function(msg) {
              console.log(msg);
            },
            error: function(xhr, ajaxOptions, thrownError) {
              console.log('Error in getting profile data.')
            }
          });
       }

       function toggle() {
         if (Cookies.get('access') != 'undefined') {
          $('.loggedin').toggleClass('show');
          $('.login').toggleClass('hide');
          profileRequest();
         }
       }

       function getQuote()
	     {
	       var rawFile = new XMLHttpRequest();
	       rawFile.open('GET', 'quotes.txt', false);
	       rawFile.onreadystatechange = function()
	       {
		         if(rawFile.readyState === 4)
		         {
		             if(rawFile.status === 200 || rawFile.status == 0)
		             {
			              var text = rawFile.responseText.split('\n');
			              var quote = text[Math.floor(Math.random()*text.length)];
			              $('.quote').text(quote);
		             }
		         }
	       }
	       rawFile.send(null);
	      }

        toggle();
	      getQuote();


    </script>
  </body>
</html>
